export default function(e){const t=(e=e||{}).lazyClass||"lazy",o=e.lazyBackgroundClass||"lazy-bg",n="idleLoadTimeout"in e?e.idleLoadTimeout:200,a=e.observeChanges||!1,i=e.events||{},r=window,s="requestIdleCallback",l="IntersectionObserver",d=["srcset","src","poster"],c=[],u=(e,n)=>c.slice.call((n||document).querySelectorAll(e||"img."+t+",video."+t+",iframe."+t+",."+o)),b=t=>{const n=t.parentNode;let a,i=[];"PICTURE"==n.nodeName&&(a=n),"VIDEO"==t.nodeName&&(a=t),i=u("source",a);for(let e in i)f(i[e]);f(t),t.autoplay&&t.load();const r=t.classList;r.contains(o)&&(r.remove(o),r.add(e.lazyBackgroundLoaded||"lazy-bg-loaded"))},v=e=>{for(let t in i)e.addEventListener(t,i[t].listener||i[t],i[t].options||void 0);m.observe(e)},f=e=>{d.forEach(t=>{t in e.dataset&&r.requestAnimationFrame(()=>{e[t]=e.dataset[t]})})};let g=u();if(/baidu|(?:google|bing|yandex|duckduck)bot/i.test(navigator.userAgent))for(let e in g)b(g[e]);else if(l in r&&l+"Entry"in r){var m=new r[l]((e,o)=>{e.forEach(e=>{if(e.intersectionRatio){const i=e.target;s in r&&n?r[s](()=>{b(i)},{timeout:n}):b(i),i.classList.remove(t),o.unobserve(i),(g=g.filter(e=>e!=i)).length||a||m.disconnect()}})},{rootMargin:("threshold"in e?e.threshold:200)+"px 0%"});for(let e in g)v(g[e]);a&&new MutationObserver(()=>{u().forEach(e=>{g.indexOf(e)<0&&(g.push(e),v(e))})}).observe(u(e.observeRootSelector||"body")[0],e.mutationObserverOptions||{childList:!0,subtree:!0})}}
